<?php
	$referer = false;
	$refererSet = false;
	if(Mage::getSingleton('core/session')->getReferer()) {
		$refererSet = true;
		$referer = Mage::getSingleton('core/session')->getReferer();
	}

	if(!$refererSet) {
		//get the referrer
		if (isset($_SERVER['HTTP_REFERER'])) {
			$referer = $_SERVER['HTTP_REFERER'];
		} else {
			$referer = "unknown";
		}
		//save it in a session variable
		Mage::getSingleton('core/session')->setReferer($referer); // store session data
	}
?>

<div id="male-status">
	<div id="male-header" class="male-header">
		<div class="container app">
			<div class="logo-container">
				<a id="logo" href="/" class="header-logo">
					<img class="gift-logo ani fadeIn scale-with-grid" alt="BRANDiD logo" src="<?php echo $this->getSkinUrl('images/logo-beta.png')?>" title="BRANDiD Logo"/>
				</a>
			</div>
			<div class="skip-container">
				<a id="skip-male" class="convert secondary" href="/mens-clothing.html">Skip This</a>
			</div>
		</div>
	</div>
	<div class="container app">
		<div class="view">
			<div class="progress-bar">
				<div class="male-round ani">
					<div class="male-holder">
						<div id="male-colour" class="male-loading">
						</div>
						<div id="male-loader" class="male-loader">
						</div>
						
						<img src="<?php echo $this->getSkinUrl('images/male/male-round.png'); ?>" alt="M.A.L.E." class="male-round ani" title="feed the male"/>
						<div class="male-label-box">
							<span id="male-label">M.A.L.E.</span>
						</div>
					</div>
					<div id="status">Establishing Connection</div>
				</div>

				<div class="progress-item first ani fadeOutDown">
					<div class="circles active">
						<div class="circle-back back">
						</div>
						<div class="circle-back">
						</div>
						<div class="circle">
							<div class="circle-text">
								1
							</div>
						</div>
					</div>
					<div class="progress-sub">Feed the M.A.L.E.</div>
				</div>
				
				<div class="progress-item second ani fadeOutDown">
					<div class="circles fadeInDown">
						<div class="circle-back">
						</div>
						<div class="circle">
							<div class="circle-text">
								2
							</div>
						</div>
					</div>
					<div class="progress-sub">Confirm Plan</div>
				</div>
				<div class="progress-item third ani fadeOutDown">
					<div class="circles">
						<div class="circle-back">
						</div>
						<div class="circle">
							<div class="circle-text">
								3
							</div>
						</div>
					</div>
					<div class="progress-sub">Checkout</div>
				</div>
			</div>

			<div class="male-console ani">
					<div id="console"></div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	var $j = jQuery.noConflict();
	//global punter object
	var punter = new Object();
	createPunter();
	function workImages(appendTo) {

		var images = new Array();
		images[0] = new Array("<?php echo $this->getSkinUrl('images/male/work/1.jpg'); ?>", "work-image", "suit, maybe a tie", "workAa()");
		images[1] = new Array("<?php echo $this->getSkinUrl('images/male/work/2.jpg'); ?>", "work-image", "shirt, jeans, shoes", "workAb()");
		images[2] = new Array("<?php echo $this->getSkinUrl('images/male/work/3.jpg'); ?>", "work-image", "tee, jeans, sneakers", "workAc()");
		images[3] = new Array("<?php echo $this->getSkinUrl('images/male/work/4.jpg'); ?>", "work-image", "au naturalle", "workAd()");

		var imageString = printImage(images);
		performAppend(appendTo, imageString);
		
			var buttons = new Array();
			buttons[0] = new Array("convert","Smart", "workAa()");
			buttons[1] = new Array("convert","Casual", "workAb()");
			buttons[2] = new Array("convert","Laid Back", "workAc()");
			buttons[3] = new Array("convert","Gorilla Suit", "workAd()");
			insertImageButtons(buttons,"work-image");
		
	}


	function playImages(appendTo) {

		var images = new Array();
		images[0] = new Array("<?php echo $this->getSkinUrl('images/male/play/1.jpg'); ?>", "play-image", "shirt, jeans", "playAa()");
		images[1] = new Array("<?php echo $this->getSkinUrl('images/male/play/2.jpg'); ?>", "play-image", "polos", "playAb()");
		images[2] = new Array("<?php echo $this->getSkinUrl('images/male/play/3.jpg'); ?>", "play-image", "tees", "playAc()");
		images[3] = new Array("<?php echo $this->getSkinUrl('images/male/play/4.jpg'); ?>", "play-image", "elvis outfit", "playAd()");

		var imageString = printImage(images);
		performAppend(appendTo, imageString);

			var buttons = new Array();
			buttons[0] = new Array("convert","Suave", "playAa()");
			buttons[1] = new Array("convert","Clubhouse", "playAb()");
			buttons[2] = new Array("convert","Whatever", "playAc()");
			buttons[3] = new Array("convert","King", "playAd()");
			insertImageButtons(buttons,"play-image");
	}

	function rollImages(appendTo) {
	
		var delay = getDelayRequired();
		// type has to go after, otherwise the delay counts only one or two chars
		typeit();

		var images = new Array();
		images[0] = new Array("<?php echo $this->getSkinUrl('images/male/roll/1.jpg'); ?>", "roll-image", "", "rollAa()");
		images[1] = new Array("<?php echo $this->getSkinUrl('images/male/roll/2.jpg'); ?>", "roll-image", "", "rollAb()");
		images[2] = new Array("<?php echo $this->getSkinUrl('images/male/roll/3.jpg'); ?>", "roll-image", "", "rollAc()");
		images[3] = new Array("<?php echo $this->getSkinUrl('images/male/roll/4.jpg'); ?>", "roll-image", "", "rollAd()");

		var imageString = printImage(images);
		performAppend(appendTo, imageString);

		var buttons = new Array();
		buttons[0] = new Array("convert","Private Jet", "rollAa()");
		buttons[1] = new Array("convert","Business Class", "rollAb()");
		buttons[2] = new Array("convert","Economy", "rollAc()");
		buttons[3] = new Array("convert","Bus", "rollAd()");
		insertImageButtons(buttons,"roll-image");
		
	}
	
	var attach;
	attach = function() {

		
		var imageUrl = '<?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('offside_pic')->toHtml(); ?>';
			//must be format <p><img src="..." /></p>

		var imageUrl = imageUrl.split('\"');

		var images = new Array();
		images[0] = new Array(imageUrl[1],"offside", "Which player is offside?");

		var imageString = printImage(images);
		$j('#male-welcome-msg').append(imageString);

		//make question text appear
		var s = getLatestSpan();
		$j(s).css('color','#444');
	}

	function beckham() {
		var images = new Array();
		images[0] = new Array("<?php echo $this->getSkinUrl('images/male/offside/beckham.jpeg'); ?>","offside-beckham", '');

		var imageString = printImage(images);
		$j('#male-welcome-msg').append(imageString);
		adjustHeight('beckham');
	}


	function startMale() {

		// this is to drop people back in if they bounced half way
		if(punter.fname != undefined && punter.justStarted === false) {
	        var backMessage = new Array(", I thought you were gone forever! ", ", missing me already, eh? ", ", I knew you\'d be back. I could feel it. ");
	        var i = Math.floor(Math.random()*3);
        	
        	var q = 'Hey '+punter.fname+backMessage[i];
        	newQ(q);
        	
        	setTimeout('returningVisitor();',1500);
        	initiate();
        }
        // this is to start people off if they came directly from the homepage
        else if(punter.fname != undefined && punter.justStarted === true) {
        	nameA(punter.fname);
        	
        }
        else {

        	
        	var q = 'Well hello there.\n\nM.A.L.E. here, what\'s your name? ';
        	newQ(q);

			insertNameButton();
        }

	}

</script>

<script type="text/javascript">
	function getReferer() {
		var referer;
		referer = '<?php echo parse_url($referer,PHP_URL_HOST); ?>';
		return referer;
	}
</script>

<script type="text/javascript">
	function loaded(){
			jQuery('#male-status').addClass('online');
			jQuery('.male-header').addClass('flyup');
			jQuery('#male-colour').removeClass('male-loading');
			jQuery('#male-colour').addClass('male-back');
			jQuery('#status').text('Feed the M.A.L.E.');

			setTimeout("startMale()", 800);
		}

	jQuery(document).ready(function() {
		window.scrollTo(0,0);
		setTimeout("loaded()", 3000);
		setTimeout(function() {
		  return $j('.male-round').addClass('fadeIn');
		}, 2000);
	});

</script>

