<?php $_product = Mage::getModel('catalog/product')->load(Mage::registry('current_product')->getId());?>
<div class="sliders">
<?php
$pieces = array(
	'Socks'		=> 'SOCKS',
	'Boxers'	=> 'BOXERS',
	'T-Shirts'	=> 'T-SHIRT',
	'Shirts'	=> 'SHIRT'
);
$relatedProductIds = array();
foreach($_product->getRelatedLinkCollection() as $related) {
	$relatedProductIds[] = $related->getLinkedProductId();
}
?>
<?php
foreach ($pieces as $k => $v) {
	$products = Mage::getModel('catalog/product')
		->getCollection()
		->addAttributeToSelect('*')
		->addAttributeToFilter('rmscategory', $v)
		->addAttributeToFilter('entity_id', array('in' => $relatedProductIds));	

if ($products->count() > 0){ ?>
<div id="planOther">
	<h1 class="black-title-bar"><?php echo $this->__($k);?></h1>	
	<div class="holder">
	
		<div class="slider">
			<ul>
			<?php foreach($products as $product): ?>
				<?php $_product = Mage::getModel('catalog/product')->load($product->getId());?>
				<li>
					<img src="<?php echo $this->helper('catalog/image')->init($product, 'image')->resize(191, 155);?>" width="191" height="155" />
					<span class="black-title-small"><?php echo $_product->getAttributeText('brand'); ?></span>
					<span><?php echo Mage::helper('core')->currency($product->getPrice(), true); ?></span>
				</li>
			<? endforeach ?>
			</ul>
		</div>
		<div class="left"></div>		
		<div class="right"></div>	
	</div>
</div>
<?php 
	};
}
?>
</div>
<div class="product-info">
    <div class="container2">
    <?php echo $this->getChildChildHtml('container2', '', true, true) ?>
    </div>
    <div class="add-to-box">
        <?php echo $this->getChildHtml('addtocart') ?>
        <?php echo $this->getChildHtml('addto') ?>
    </div>
</div>

<script type="text/javascript">

	$('product-options-wrapper').select('label').each(function(obj){
		if (obj.innerHTML.toLowerCase().indexOf('sock') >= 0) {
			obj.up().next().addClassName('sock-bg');
		} else if (obj.innerHTML.toLowerCase().indexOf('t-shirt') >= 0) {
			obj.up().next().addClassName('tshirt-bg');	
		} else if (obj.innerHTML.toLowerCase().indexOf('boxer') >= 0) {
			obj.up().next().addClassName('boxer-bg');		
		} else if (obj.innerHTML.toLowerCase().indexOf('shirt') >= 0) {
			obj.up().next().addClassName('shirt-bg');		
		}
		console.log(obj.innerHTML);
	});

	$$('.holder .slider').each(function(obj){
		var calculatedWidth = obj.select('ul li').length * parseInt(obj.select('ul li')[0].getStyle('width'));
		obj.setStyle({ width: calculatedWidth + 'px' });
	});
	
	$$('.holder .left').each(function(obj){
		obj.observe('click', function(){
			var target = obj.up().firstDescendant().firstDescendant().childElements()[obj.up().firstDescendant().firstDescendant().childElements().length-1];

			var lastChild = document.createElement('li');
			lastChild.innerHTML = target.innerHTML;
			target.remove();
			obj.up().firstDescendant().firstDescendant().insert({top: lastChild });
			target = lastChild;
			target.setStyle({ marginLeft: (parseInt(target.getStyle('width'))*-1) + 'px' })			
			var start = parseInt(target.getStyle('margin-left'));
			var end = start + parseInt(target.getStyle('width'));
			
			new Effect.Tween(
				target, start, end, { duration: 0.5	},
				function(p) { this.setStyle({marginLeft : p + "px" }) }
			);
		});	
	});
	$$('.holder .right').each(function(obj){
		obj.observe('click', function(){
			var target = obj.up().firstDescendant().firstDescendant().firstDescendant();
			var start = parseInt(target.getStyle('margin-left'));
			var end = start + (parseInt(target.getStyle('width')) * -1);
			new Effect.Tween(
				target, start, end, {
					duration: 0.5, afterFinish: function(){
						
						if (end != parseInt(target.getStyle('width'))*-1) {
							var lastChild = document.createElement('li');
							lastChild.innerHTML = target.innerHTML;
							target.remove();
							obj.up().firstDescendant().firstDescendant().insert(lastChild);
						}
					}
				},
				function(p) { this.setStyle({marginLeft : p + "px" }) }
			);
		});
	});
	
	
</script>