<?php
$products = Mage::getModel('catalog/product')->getCollection()->addAttributeToSelect('*')->addAttributeToFilter('rmscategory', 'Shirt');

if ($products->count() > 0): ?>
<div id="planOther">
	<h1><?php echo $this->__('Shirts');?></h1>	
	<div class="holder">
	
		<div class="slider">
			<ul>
			<?php foreach($products as $product): ?>
				<li><?php echo $product->getName(); ?></li>
			<? endforeach ?>
			</ul>
		</div>
		<div class="left"></div>		
		<div class="right"></div>	
	</div>
</div>
<?php endif; ?>

<script type="text/javascript">

	$$('.holder .slider').each(function(obj){
		var calculatedWidth = obj.select('ul li').length * parseInt(obj.select('ul li')[0].getStyle('width'));
		obj.setStyle({ width: calculatedWidth + 'px' });
	});
	
	$$('.holder .left').each(function(obj){
		obj.observe('click', function(){
			var target = obj.up().firstDescendant().firstDescendant().childElements()[obj.up().firstDescendant().firstDescendant().childElements().length-1];

			var lastChild = document.createElement('li');
			lastChild.innerHTML = target.innerHTML;
			target.remove();
			obj.up().firstDescendant().firstDescendant().insert({top: lastChild });
			target = lastChild;
			target.setStyle({ marginLeft: (parseInt(target.getStyle('width'))*-1) + 'px' })			
			var start = parseInt(target.getStyle('margin-left'));
			var end = start + parseInt(target.getStyle('width'));
			
			new Effect.Tween(
				target, start, end, { duration: 0.5	},
				function(p) { this.setStyle({marginLeft : p + "px" }) }
			);
		});	
	});
	$$('.holder .right').each(function(obj){
		obj.observe('click', function(){
			var target = obj.up().firstDescendant().firstDescendant().firstDescendant();
			var start = parseInt(target.getStyle('margin-left'));
			var end = start + (parseInt(target.getStyle('width')) * -1);
			new Effect.Tween(
				target, start, end, {
					duration: 0.5, afterFinish: function(){
						
						if (end != parseInt(target.getStyle('width'))*-1) {
							var lastChild = document.createElement('li');
							lastChild.innerHTML = target.innerHTML;
							target.remove();
							obj.up().firstDescendant().firstDescendant().insert(lastChild);
						}
					}
				},
				function(p) { this.setStyle({marginLeft : p + "px" }) }
			);
		});
	});
	
</script>